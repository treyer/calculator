describe('History expressions add', () => {
  beforeEach(() => {
    cy.visit('/')
  })

  it('check empty history block', () => {
    cy.getBySel('history')
      .should('be.visible')
      .contains('History')
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 0)
  })

  it('no history add on one operand expression', () => {
    cy.getBySel('display-output')
      .invoke('text')
      .then(text => expect(text.trim()).equal('0'))
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 0)
    cy.enterBasicKeypadExpression('1=')
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 0)
  })

  it('no history add on one operand and one operator expression', () => {
    cy.getBySelAndCheckTextInside('display-output', '0')
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 0)
    cy.enterBasicKeypadExpression('1+=')
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 0)
  })

  it('history add on correct expression count', () => {
    cy.getBySelAndCheckTextInside('display-output', '0')
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 0)
    cy.enterBasicKeypadExpression('1+1=')
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 1)
    cy.getBySel('history-content-box')
      .contains('1 + 1 = 2')
      .should('be.visible')
  })

  it('history add multiple history expressions', () => {
    cy.getBySelAndCheckTextInside('display-output', '0')
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 0)
    cy.enterBasicKeypadExpression('1+1=')
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 1)
    cy.getBySel('history-content-box')
      .contains('1 + 1 = 2')
      .should('be.visible')
    cy.clearCalculationResult()
    cy.getBySelAndCheckTextInside('display-output', '0')

    cy.enterBasicKeypadExpression('2+2=')
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 2)
    cy.getBySel('history-content-box')
      .contains('2 + 2 = 4')
      .should('be.visible')
    cy.clearCalculationResult()
    cy.getBySelAndCheckTextInside('display-output', '0')

    cy.enterBasicKeypadExpression('3+3=')
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 3)
    cy.getBySel('history-content-box')
      .contains('3 + 3 = 6')
      .should('be.visible')
    cy.getBySel('history-content-box')
      .contains('2 + 2 = 4')
      .should('be.visible')
    cy.getBySel('history-content-box')
      .contains('1 + 1 = 2')
      .should('be.visible')
  })
})

describe('History expressions set to display output', () => {
  beforeEach(() => {
    cy.visit('/')
  })

  it('add single history expression to display', () => {
    cy.getBySelAndCheckTextInside('display-output', '0')
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 0)
    cy.enterBasicKeypadExpression('2+2=')
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 1)
    cy.getBySel('history-content-box')
      .contains('2 + 2 = 4')
      .should('be.visible')
    cy.getBySelAndCheckTextInside('display-output', '4')
    cy.getBySel('history-content-box')
      .contains('2 + 2 = 4')
      .click()
    cy.getBySelAndCheckTextInside('display-output', '2 + 2')
  })

  it('add one of multiple history expressions to display', () => {
    cy.getBySelAndCheckTextInside('display-output', '0')
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 0)
    cy.enterBasicKeypadExpression('2+2=')
    cy.clearCalculationResult()
    cy.enterBasicKeypadExpression('3+3=')
    cy.clearCalculationResult()
    cy.enterBasicKeypadExpression('4+4=')
    cy.clearCalculationResult()
    cy.getBySelAndCheckTextInside('display-output', '0')
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 3)
    cy.getBySel('history-content-box')
      .contains('2 + 2 = 4')
      .should('be.visible')
    cy.getBySel('history-content-box')
      .contains('3 + 3 = 6')
      .should('be.visible')
    cy.getBySel('history-content-box')
      .contains('4 + 4 = 8')
      .should('be.visible')

    cy.getBySel('history-content-box')
      .contains('2 + 2 = 4')
      .click()
    cy.getBySelAndCheckTextInside('display-output', '2 + 2')
    cy.getBySel('history-content-box')
      .contains('3 + 3 = 6')
      .click()
    cy.getBySelAndCheckTextInside('display-output', '3 + 3')
    cy.getBySel('history-content-box')
      .contains('4 + 4 = 8')
      .click()
    cy.getBySelAndCheckTextInside('display-output', '4 + 4')
  })
})

describe('History expressions remove', () => {
  beforeEach(() => {
    cy.visit('/')
  })

  it('remove history expressions from history box', () => {
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 0)
    cy.enterBasicKeypadExpression('2+2=')
    cy.clearCalculationResult()
    cy.enterBasicKeypadExpression('3+3=')
    cy.clearCalculationResult()
    cy.enterBasicKeypadExpression('4+4=')
    cy.clearCalculationResult()

    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 3)
    cy.getBySel('history-content-box')
      .contains('2 + 2 = 4')
      .should('be.visible')
    cy.getBySel('history-content-box')
      .contains('3 + 3 = 6')
      .should('be.visible')
    cy.getBySel('history-content-box')
      .contains('4 + 4 = 8')
      .should('be.visible')

    cy.getBySel('history-content-box')
      .contains('4 + 4 = 8')
      .children()
      .click()
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 2)
    cy.getBySel('history-content-box')
      .contains('2 + 2 = 4')
      .should('be.visible')
    cy.getBySel('history-content-box')
      .contains('3 + 3 = 6')
      .should('be.visible')
    cy.getBySel('history-content-box')
      .contains('4 + 4 = 8')
      .should('not.exist')

    cy.getBySel('history-content-box')
      .contains('2 + 2 = 4')
      .children()
      .click()
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 1)
    cy.getBySel('history-content-box')
      .contains('3 + 3 = 6')
      .should('be.visible')
    cy.getBySel('history-content-box')
      .contains('2 + 2 = 4')
      .should('not.exist')

    cy.getBySel('history-content-box')
      .contains('3 + 3 = 6')
      .children()
      .click()
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 0)
    cy.getBySel('history-content-box')
      .contains('3 + 3 = 6')
      .should('not.exist')
  })
})

describe('Remove history expressions by clear button', () => {
  beforeEach(() => {
    cy.visit('/')
  })

  it('remove single history expression', () => {
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 0)
    cy.enterBasicKeypadExpression('2+2=')
    cy.clearCalculationResult()
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 1)
    cy.getBySel('history-content-box').contains('2 + 2 = 4')
    cy.getBySel('clear-history-block-button').click()
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 0)
    cy.getBySel('history-content-box')
      .contains('2 + 2 = 4')
      .should('not.exist')
  })

  it('remove multiple history expressions', () => {
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 0)
    cy.enterBasicKeypadExpression('2+2=')
    cy.clearCalculationResult()
    cy.enterBasicKeypadExpression('3+3=')
    cy.clearCalculationResult()
    cy.enterBasicKeypadExpression('4+4=')
    cy.clearCalculationResult()
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 3)
    cy.getBySel('history-content-box').contains('2 + 2 = 4')
    cy.getBySel('history-content-box').contains('3 + 3 = 6')
    cy.getBySel('history-content-box').contains('4 + 4 = 8')
    cy.getBySel('clear-history-block-button').click()
    cy.getBySel('history-content-box')
      .children()
      .should('have.length', 0)
    cy.getBySel('history-content-box')
      .contains('2 + 2 = 4')
      .should('not.exist')
    cy.getBySel('history-content-box')
      .contains('3 + 3 = 6')
      .should('not.exist')
    cy.getBySel('history-content-box')
      .contains('4 + 4 = 8')
      .should('not.exist')
  })
})
